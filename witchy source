--// Load Rayfield UI
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

--// Create Window
local Window = Rayfield:CreateWindow({
   Name = "Baddies Caribbean | Witches Brew",
   LoadingTitle = "Baddies Caribbean",
   LoadingSubtitle = "by Jace x",
   Theme = "Purple",
   KeySystem = true,
   KeySettings = {
      Title = "Witches Caribbean",
      Subtitle = "discord.gg/yourserver",
      Note = "No Entry For Thee",
      FileName = "WitchesBrew",
      SaveKey = false,
      GrabKeyFromSite = false,
      Key = {"WitchesBrew"}
   }
})

--// Tabs and Sections
local MainTab = Window:CreateTab("Main", nil)
local CastleTab = Window:CreateTab("Castle", nil)

local MainSection = MainTab:CreateSection("Combat")
local CastleSection = CastleTab:CreateSection("Sky Castle")

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

--// Castle Setup
local function createFullCastle()
   local castle = Instance.new("Model", workspace)
   castle.Name = "FloatingCastle"

   local platform = Instance.new("Part", castle)
   platform.Size = Vector3.new(120,2,120)
   platform.Anchored = true
   platform.Position = Vector3.new(0,400,0)
   platform.BrickColor = BrickColor.new("Royal purple")
   platform.Material = Enum.Material.SmoothPlastic

   for _, offset in ipairs({
      Vector3.new(0,10,60), Vector3.new(0,10,-60),
      Vector3.new(60,10,0), Vector3.new(-60,10,0)
   }) do
      local wall = Instance.new("Part", castle)
      wall.Size = Vector3.new(120,20,2)
      wall.Position = platform.Position + offset
      wall.Anchored = true
      wall.BrickColor = BrickColor.new("Really black")
      wall.Material = Enum.Material.Neon
   end

   local roof = Instance.new("Part", castle)
   roof.Size = Vector3.new(120,2,120)
   roof.Position = platform.Position + Vector3.new(0,22,0)
   roof.Anchored = true
   roof.BrickColor = BrickColor.new("Royal purple")
   roof.Material = Enum.Material.SmoothPlastic

   local table = Instance.new("Part", castle)
   table.Size = Vector3.new(40,2,10)
   table.Position = platform.Position + Vector3.new(0,5,0)
   table.Anchored = true
   table.BrickColor = BrickColor.new("Royal purple")

   for i = -2, 2 do
      if i ~= 0 then
         local chair = Instance.new("Seat", castle)
         chair.Size = Vector3.new(4,2,4)
         chair.Position = table.Position + Vector3.new(i*8,2,8)
         chair.Anchored = true
         chair.BrickColor = BrickColor.new("Really black")

         local chair2 = chair:Clone()
         chair2.Parent = castle
         chair2.Position = table.Position + Vector3.new(i*8,2,-8)
      end
   end

   local smoke = Instance.new("ParticleEmitter", platform)
   smoke.Color = ColorSequence.new(Color3.fromRGB(200, 0, 200))
   smoke.Size = NumberSequence.new(6)
   smoke.Rate = 150
   smoke.Lifetime = NumberRange.new(4)
   smoke.Speed = NumberRange.new(2)
end

createFullCastle()

--// Castle Teleport
CastleTab:CreateButton({
   Name = "Teleport to Castle",
   Callback = function()
      local char = LocalPlayer.Character
      if char and char:FindFirstChild("HumanoidRootPart") then
         char.HumanoidRootPart.CFrame = CFrame.new(0,405,0)
      end
   end,
})

--// Misty Teleport Keybind (C)
MainTab:CreateKeybind({
   Name = "Misty Teleport",
   CurrentKeybind = "C",
   HoldToInteract = false,
   Callback = function()
      local char = LocalPlayer.Character
      if char and char:FindFirstChild("HumanoidRootPart") then
         char.HumanoidRootPart.CFrame = CFrame.new(0,405,0)
      end
   end,
})

--// Summon Witches Command (fixed)
LocalPlayer.Chatted:Connect(function(msg)
   if msg:lower() == "witches!" then
      local origin = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
      if origin then
         for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
               player.Character.HumanoidRootPart.CFrame = origin.CFrame + Vector3.new(math.random(-5,5), 2, math.random(-5,5))
            end
         end
      end
   end
end)

--// Core Powers
MainTab:CreateKeybind({
   Name = "Rush All",
   CurrentKeybind = "T",
   HoldToInteract = false,
   Callback = function()
      for _, player in ipairs(Players:GetPlayers()) do
         if player ~= LocalPlayer then
            ReplicatedStorage.events.DuoPlrEvents:FireServer("Rush", player.Name)
         end
      end
   end,
})

MainTab:CreateKeybind({
   Name = "Headlock All",
   CurrentKeybind = "R",
   HoldToInteract = false,
   Callback = function()
      for _, player in ipairs(Players:GetPlayers()) do
         if player ~= LocalPlayer then
            ReplicatedStorage.events.DuoPlrEvents:FireServer("DamageTool", player.Name)
         end
      end
   end,
})

MainTab:CreateButton({
   Name = "Gain Infinite Money",
   Callback = function()
      ReplicatedStorage.events.MoneyGain:FireServer(1e16)
   end,
})

MainTab:CreateButton({
   Name = "Infinite Yield",
   Callback = function()
      loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
   end,
})

MainTab:CreateButton({
   Name = "Lose Fight",
   Callback = function()
      ReplicatedStorage.events.SoloPlrEvents:FireServer("LooseFight")
   end,
})

MainTab:CreateButton({
   Name = "Kill All",
   Callback = function()
      for _, player in ipairs(Players:GetPlayers()) do
         if player ~= LocalPlayer then
            ReplicatedStorage.events.DuoPlrEvents:FireServer("DamageTool", player.Name)
         end
      end
      
      local StarterGui = game:GetService("StarterGui")
      StarterGui:SetCore("SendNotification", {
         Title = "Baddie Attack",
         Text = "SUFFER.",
         Duration = 2
      })

      local char = LocalPlayer.Character
      if char and char:FindFirstChild("HumanoidRootPart") then
         local explosion = Instance.new("Explosion")
         explosion.Position = char.HumanoidRootPart.Position
         explosion.BlastRadius = 10
         explosion.BlastPressure = 50000
         explosion.Parent = workspace
      end

      task.wait(1.2)
      LocalPlayer.Character:BreakJoints()
   end,
})

MainTab:CreateButton({
   Name = "Mace All",
   Callback = function()
      for _, player in ipairs(Players:GetPlayers()) do
         if player ~= LocalPlayer then
            ReplicatedStorage.events.DuoPlrEvents:FireServer("Rush", player.Name)
            task.wait(0.1)
            ReplicatedStorage.events.DuoPlrEvents:FireServer("Fire", player.Name)
         end
      end
   end,
})

--// NEW: Dark Grab (Single Target with G)
MainTab:CreateKeybind({
   Name = "Dark Grab Target",
   CurrentKeybind = "G",
   HoldToInteract = false,
   Callback = function()
      local target = nil
      Mouse.Button1Down:Connect(function()
         local obj = Mouse.Target
         if obj and obj:IsDescendantOf(workspace) then
            local model = obj:FindFirstAncestorOfClass("Model")
            local player = Players:GetPlayerFromCharacter(model)
            if player and player ~= LocalPlayer then
               target = player
               ReplicatedStorage.events.DuoPlrEvents:FireServer("Rush", player.Name)

               local fx = Instance.new("ParticleEmitter")
               fx.Color = ColorSequence.new(Color3.fromRGB(50, 0, 100))
               fx.Size = NumberSequence.new(5)
               fx.Lifetime = NumberRange.new(2)
               fx.Rate = 100
               fx.Speed = NumberRange.new(0)
               fx.Parent = model:FindFirstChild("HumanoidRootPart")

               game.Debris:AddItem(fx, 2)
            end
         end
      end)
   end,
})
