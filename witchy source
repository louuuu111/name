--// Load Rayfield UI
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

--// Create Window
local Window = Rayfield:CreateWindow({
   Name = "Baddies Caribbean | Witches Brew",
   LoadingTitle = "Baddies Caribbean",
   LoadingSubtitle = "by Jace x",
   Theme = "Purple",
   KeySystem = true,
   KeySettings = {
      Title = "Witches Caribbean",
      Subtitle = "discord.gg/yourserver",
      Note = "No Entry For Thee",
      FileName = "WitchesBrew",
      SaveKey = false,
      GrabKeyFromSite = false,
      Key = {"WitchesBrew"}
   }
})

--// Tabs and Sections
local MainTab = Window:CreateTab("Main", nil)
local CastleTab = Window:CreateTab("Castle", nil)
local MainSection = MainTab:CreateSection("Combat")
local CastleSection = CastleTab:CreateSection("Sky Castle")

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

--// Sound Function
local function playWhisperSound()
   local sound = Instance.new("Sound", LocalPlayer:WaitForChild("PlayerGui"))
   sound.SoundId = "rbxassetid://9118823102"
   sound.Volume = 0.7
   sound:Play()
end

--// Mist + FX Generator
local function createMistEffect(position)
   local part = Instance.new("Part")
   part.Size = Vector3.new(1,1,1)
   part.Position = position
   part.Anchored = true
   part.Transparency = 1
   part.CanCollide = false
   part.Parent = workspace

   local emitter = Instance.new("ParticleEmitter", part)
   emitter.Color = ColorSequence.new(Color3.fromRGB(160, 0, 200))
   emitter.Rate = 100
   emitter.Lifetime = NumberRange.new(3)
   emitter.Size = NumberSequence.new(5)
   emitter.Speed = NumberRange.new(1, 2)
   emitter.Transparency = NumberSequence.new({
       NumberSequenceKeypoint.new(0, 0),
       NumberSequenceKeypoint.new(1, 1)
   })
   game.Debris:AddItem(part, 5)
end

--// Exclusive Visibility Check
local function isScriptUser(player)
   return player.Name == LocalPlayer.Name or player:FindFirstChild("PlayerGui")
end

--// Full Castle Summon System
CastleTab:CreateButton({
   Name = "Summon Castle",
   Callback = function()
      if workspace:FindFirstChild("FloatingCastle") then return end

      local castle = Instance.new("Model", workspace)
      castle.Name = "FloatingCastle"

      local platform = Instance.new("Part", castle)
      platform.Size = Vector3.new(120,2,120)
      platform.Anchored = true
      platform.Position = Vector3.new(0,400,0)
      platform.BrickColor = BrickColor.new("Really black")
      platform.Material = Enum.Material.Slate

      local mist = Instance.new("ParticleEmitter", platform)
      mist.Color = ColorSequence.new(Color3.fromRGB(160, 0, 200))
      mist.Size = NumberSequence.new(6)
      mist.Rate = 150
      mist.Lifetime = NumberRange.new(5)
      mist.Speed = NumberRange.new(1,3)

      playWhisperSound()
   end
})

CastleTab:CreateButton({
   Name = "Exit Castle",
   Callback = function()
      local castle = workspace:FindFirstChild("FloatingCastle")
      if castle then castle:Destroy() end
   end
})

CastleTab:CreateButton({
   Name = "Teleport to Castle",
   Callback = function()
      local char = LocalPlayer.Character
      if char and char:FindFirstChild("HumanoidRootPart") then
         char.HumanoidRootPart.CFrame = CFrame.new(0,405,0)
         createMistEffect(char.HumanoidRootPart.Position)
      end
   end
})

--// Powers Section
MainTab:CreateKeybind({
   Name = "Dark Bind",
   CurrentKeybind = "Z",
   HoldToInteract = false,
   Callback = function()
      for _, player in ipairs(Players:GetPlayers()) do
         if player ~= LocalPlayer and isScriptUser(player) then
            ReplicatedStorage.events.DuoPlrEvents:FireServer("Stun", player.Name)
         end
      end
   end
})

MainTab:CreateKeybind({
   Name = "Mist Swell",
   CurrentKeybind = "X",
   HoldToInteract = false,
   Callback = function()
      createMistEffect(LocalPlayer.Character.HumanoidRootPart.Position)
      for _, player in ipairs(Players:GetPlayers()) do
         if player ~= LocalPlayer and isScriptUser(player) then
            ReplicatedStorage.events.DuoPlrEvents:FireServer("Freeze", player.Name)
         end
      end
   end
})

MainTab:CreateKeybind({
   Name = "Witch Slam",
   CurrentKeybind = "V",
   HoldToInteract = false,
   Callback = function()
      for _, player in ipairs(Players:GetPlayers()) do
         if player ~= LocalPlayer and isScriptUser(player) then
            ReplicatedStorage.events.DuoPlrEvents:FireServer("Slam", player.Name)
         end
      end
   end
})

MainTab:CreateKeybind({
   Name = "Fear Blast",
   CurrentKeybind = "B",
   HoldToInteract = false,
   Callback = function()
      for _, player in ipairs(Players:GetPlayers()) do
         if player ~= LocalPlayer and isScriptUser(player) then
            ReplicatedStorage.events.DuoPlrEvents:FireServer("Kill", player.Name)
         end
      end
   end
})

MainTab:CreateKeybind({
   Name = "Soul Pull",
   CurrentKeybind = "N",
   HoldToInteract = false,
   Callback = function()
      for _, player in ipairs(Players:GetPlayers()) do
         if player ~= LocalPlayer and isScriptUser(player) then
            local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            local target = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
            if root and target then
               target.CFrame = root.CFrame + Vector3.new(math.random(-2,2), 1, math.random(-2,2))
               task.wait(0.4)
               ReplicatedStorage.events.DuoPlrEvents:FireServer("Explosion", player.Name)
            end
         end
      end
   end
})

MainTab:CreateKeybind({
   Name = "Revive Self",
   CurrentKeybind = "M",
   HoldToInteract = false,
   Callback = function()
      local char = LocalPlayer.Character
      if char and char:FindFirstChild("Humanoid") then
         local humanoid = char:FindFirstChild("Humanoid")
         humanoid.Health = humanoid.MaxHealth
         char.HumanoidRootPart.CFrame = char.HumanoidRootPart.CFrame + Vector3.new(0,5,0)
         local reviveFX = Instance.new("ParticleEmitter", char.HumanoidRootPart)
         reviveFX.Color = ColorSequence.new(Color3.new(0.7, 0, 1))
         reviveFX.Size = NumberSequence.new(4)
         reviveFX.Rate = 50
         reviveFX.Lifetime = NumberRange.new(2)
         reviveFX.Speed = NumberRange.new(2)
         game.Debris:AddItem(reviveFX, 3)
      end
   end
})

MainTab:CreateKeybind({
   Name = "Witch Rise",
   CurrentKeybind = "C",
   HoldToInteract = false,
   Callback = function()
      local char = LocalPlayer.Character
      local root = char and char:FindFirstChild("HumanoidRootPart")
      if root then
         -- Levitate effect (client-side)
         local levitatePart = Instance.new("Part", workspace)
         levitatePart.Anchored = true
         levitatePart.Transparency = 1
         levitatePart.CanCollide = false
         levitatePart.Position = root.Position
         game.Debris:AddItem(levitatePart, 2)

         local swirl = Instance.new("ParticleEmitter", levitatePart)
         swirl.Color = ColorSequence.new(Color3.fromRGB(180, 0, 255))
         swirl.Size = NumberSequence.new(4)
         swirl.Lifetime = NumberRange.new(1)
         swirl.Rate = 100
         swirl.Speed = NumberRange.new(2)
         swirl.Rotation = NumberRange.new(360)
         swirl.RotSpeed = NumberRange.new(100)

         -- Rise motion
         local bodyVel = Instance.new("BodyVelocity", root)
         bodyVel.Velocity = Vector3.new(0, 50, 0)
         bodyVel.MaxForce = Vector3.new(0, 1e5, 0)
         game.Debris:AddItem(bodyVel, 0.4)

         task.delay(0.5, function()
            ReplicatedStorage.events.DuoPlrEvents:FireServer("Slam", LocalPlayer.Name)
         end)

         playWhisperSound()
      end
   end
})
